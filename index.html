<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi Task & Booster</title>
    <!-- Integrasi Pi SDK -->
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <script>
        Pi.init({ version: "2.0" });
    </script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background: #f0f0f0; color: #333; }
        h1 { color: #6a0dad; }
        #status { font-size: 18px; margin: 20px; }
        #timer { font-size: 36px; font-weight: bold; margin: 30px; }
        button { padding: 15px 30px; font-size: 18px; background: #6a0dad; color: white; border: none; cursor: pointer; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .task { margin: 20px; font-size: 16px; }
    </style>
</head>
<body>
    <h1>Pi Task & Booster</h1>
    <div id="status">Menghubungkan ke Pi...</div>
    <div id="timer">Sesi Aktif Berikutnya: 24:00:00</div>
    <button id="boosterBtn" disabled>AKTIFKAN BOOSTER</button>
    <div class="task">Cek Security Circle +25%</div>
    <div class="task">Verifikasi Email Selesai</div>
    <p>Gunakan Pi Browser untuk pengalaman penuh.</p>

    <script>
        let authData = null;

        // Fungsi penanganan pembayaran tidak lengkap (opsional)
        function onIncompletePaymentFound(payment) {
            console.log("Pembayaran tidak lengkap ditemukan:", payment);
            // Handle jika ada pembayaran pending (misalnya: complete atau cancel)
        }

        // Autentikasi saat halaman loaded
        window.onload = function() {
            const scopes = ["username", "payments"];

            Pi.authenticate(scopes, onIncompletePaymentFound)
                .then(function(auth) {
                    authData = auth;
                    document.getElementById("status").innerText = 
                        `Selamat datang, ${auth.user.username}! Autentikasi berhasil.`;
                    document.getElementById("boosterBtn").disabled = false;
                    console.log("UID:", auth.user.uid);
                    console.log("Access Token:", auth.accessToken);
                })
                .catch(function(error) {
                    document.getElementById("status").innerText = 
                        "Autentikasi gagal atau dibatalkan. Coba lagi di Pi Browser.";
                    console.error(error);
                });
        };

        // Event tombol Aktifkan Booster (contoh pembayaran 1 Pi)
        document.getElementById("boosterBtn").addEventListener("click", function() {
            if (!authData) {
                alert("Harap autentikasi terlebih dahulu.");
                return;
            }

            const paymentData = {
                amount: 1.0,  // Jumlah Pi untuk booster
                memo: "Aktifkan Booster Harian - Pi Task & Booster",
                metadata: { app: "timbooster", action: "activate_booster" }
            };

            const callbacks = {
                onReadyForServerApproval(paymentId) {
                    console.log("Payment ID:", paymentId);
                    // Kirim paymentId ke server backend Anda untuk approve (jika ada backend)
                },
                onReadyForServerCompletion(paymentId, txid) {
                    console.log("Pembayaran selesai. TXID:", txid);
                    alert("Booster berhasil diaktifkan!");
                    // Update UI atau timer di sini
                },
                onCancel(paymentId) {
                    console.log("Pembayaran dibatalkan.");
                    alert("Pembayaran dibatalkan.");
                },
                onError(error, payment) {
                    console.error("Error pembayaran:", error);
                    alert("Error: " + error.message);
                }
            };

            Pi.createPayment(paymentData, callbacks);
        });

        // Contoh timer sederhana (hitung mundur 24 jam)
        let timeLeft = 24 * 60 * 60;
        setInterval(function() {
            if (timeLeft > 0) {
                timeLeft--;
                const hours = Math.floor(timeLeft / 3600);
                const minutes = Math.floor((timeLeft % 3600) / 60);
                const seconds = timeLeft % 60;
                document.getElementById("timer").innerText = 
                    `Sesi Aktif Berikutnya: \( {hours.toString().padStart(2, '0')}: \){minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }, 1000);
    </script>
</body>
    </html>
